<!DOCTYPE html>
<html>
  <head>
    <title>Abbreviated 9-item RPM</title>

    <!-- Load main jsPsych plug-in to initialize jsPsych -->
    <script src="js/jspsych.js"></script>

    <!-- Load jsPsych plug-ins -->
    <script src="js/plugin-html-keyboard-response.js"></script> 
    <script src="js/plugin-fullscreen.js"></script>
    <script src="js/plugin-browser-check.js"></script>
    <script src="js/plugin-instructions.js"></script>
    <script src="js/plugin-preload.js"></script>
    <script src="js/plugin-call-function.js"></script>

    <!-- Initialize jsPsych using init-jspsych.js before loading in Flanker task -->
    <script src="js/init-jspsych.js"></script>

    <!-- Load scripts for Abbreviated 9-item version of Raven's Progessive Matrices experiment -->
    <script src="rpm_scripts/plugin-rpm.js"></script>
    <script src="rpm_scripts/plugin-screen-check.js"></script>
    <script src="rpm_scripts/rpm-tfa.js"></script>
    <script src="rpm_scripts/rpm-tfb.js"></script>

    <!-- Load default jsPsych styles -->
    <link href="js/jspsych.css" rel="stylesheet" type="text/css" />

  <style>
  /****** These are all CSS rules that will customize the aesthetics of the task *******/

/* Make the background color 'white' */
body {
  background-color: white;
       } 

.jspsych-display-element {
     font-size: 30px;
     line-height: 1.8em;
     color: black;
  }

/*Padding for text*/
.custom_padding {
  padding-left: 4vw;
  padding-right: 4vw;
}
  </style>
  
  </head>
  <body></body>
  <script>



//------------------------------------//
// Initialize Timeline
//------------------------------------//
var timeline = [];



//------------------------------------//
// Collect browser information
//------------------------------------//
timeline.push ({
    data: {
        trial_id: "Browser_check"
    },
    type: jsPsychBrowserCheck
  });


//------------------------------------//
// Make experiment Full Screen
//------------------------------------//
timeline.push({
    data: {
        trial_id: "Full_screen"
    },
    type: jsPsychFullscreen,
    fullscreen_mode: true
});



//----------------------------//
// Prepare RPM experiment
//----------------------------//

/* Query URL for RPM version*/
const urlParams = new URLSearchParams(window.location.search);
const test_form = urlParams.get('tf');


//----------------------------//
// Preload RPM images
//----------------------------//
var rpm_preload = {
    data: {
      trial_id: "rpm_preload"
  },
    type: jsPsychPreload,
    images: (test_form == "a") ? preload_rpm_tfa : preload_rpm_tfb,
    message: 'Loading images. This may take a moment depending on your internet connection.',
    error_message: '<p>The experiment failed to load. Please try restarting your browser.</p><p>If this error persists after 2-3 tries, please contact the experimenter.</p>',
    continue_after_error: false,
    show_progress_bar: true,
    max_load_time: 30000
  }


//---------------------//
// RPM Intro
//---------------------//
var rpm_intro = {
  data: {
      trial_id: "rpm_intro"
  },
  type: jsPsychInstructions,
  pages: [
    "<p><div style ='font-size:40px;'>Next, we will ask you to complete another short task.</div></p>" +
    "<p><div style ='font-size:40px;'>Click <b>Next</b> to begin reading the instructions.</div></p>"
  ],
  show_clickable_nav: true,
  css_classes: ['custom_padding'],
}


//---------------------//
// RPM Instructions
//---------------------//
  var rpm_instructions = {
    data: {
      trial_id: "rpm_instructions"
  },
    type: jsPsychInstructions,
    pages: [
      '<p><div style ="font-size:40px;">We are beginning the <b>puzzle task</b>.</p>' +
      '<p><div style ="font-size:40px;">In this task, you will be shown a series of puzzles. For each puzzle, your goal is to identify the missing piece from the options appearing below the puzzle.</div></p>' +
      '<p><div style ="font-size:40px;">There are 9 puzzles in total. You will have <b>30 seconds</b> for each puzzle.</p><p>Try to be as accurate as you can be. If you cannot solve the puzzle before time runs out, then you should guess.</p><p>Press the <b>Next</b> button to get started.</div></p>',
    ],
    show_clickable_nav: true,
    button_label_previous: 'Prev',
    button_label_next: 'Next',
    css_classes: ['custom_padding'],
  }



//-----------------------------------------//
// Concatenate RPM timeline
//----------------------------------------//
timeline = timeline.concat(rpm_preload); // RPM task
timeline = timeline.concat(rpm_intro); // RPM task
timeline = timeline.concat(rpm_instructions); // RPM task
timeline = timeline.concat((test_form == "a") ? RPM_TFa : RPM_TFb); // RPM task -- (test_form == "a") ? RPM_TFa : RPM_TFb) will run version B, whereas (test_form == "b") ? RPM_TFb : RPM_TFa) will run version A



// Execute timeline.
jsPsych.run(timeline);

  </script>
</html>